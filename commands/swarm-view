#!/bin/bash
# swarm-view: The "North Star" Mission Control Orchestrator
PROJECT_DIR=$(pwd)
BLACKBOARD="$PROJECT_DIR/TODO.md"

if [ -z "$TMUX" ]; then
  echo "Error: Run this inside a tmux session."
  exit 1
fi

# 1. Clear existing layout to ensure a clean slate
tmux kill-pane -a -t 0 2>/dev/null

# 2. Configure the Main Brain (Left Pane)
tmux select-pane -t 0 -T "[ ğŸ§  SUPERVISOR BRAIN ]"
tmux set -g pane-border-status top

# 3. Create the Task Blackboard (Top Right)
# Splits horizontally first
tmux split-window -h -p 38 "while true; do clear; echo '--- ğŸ“‹ TASK BLACKBOARD ---'; glow -s dark $BLACKBOARD 2>/dev/null || cat $BLACKBOARD; sleep 2; done"
tmux select-pane -t 1 -T "[ ğŸ“‹ TASK BLACKBOARD ]"

# 4. Create the Live Telemetry (Bottom Right)
# Splits the right pane vertically
tmux select-pane -t 1
tmux split-window -v -p 50 "while true; do clear; echo '--- ğŸ¦ SWARM TELEMETRY ---'; zmx list | grep worker || echo ' (Waiting for worker pulse...)'; echo '------------------------------------------'; tail -n 20 /tmp/actor-orchestrator/*.log 2>/dev/null | grep -v '==>' | tail -n 15; sleep 1; done"
tmux select-pane -t 2 -T "[ ğŸ¦ LIVE LOGS ]"

# 5. Final Focus: Return to Supervisor
tmux select-pane -t 0
clear
echo "--- Mission Control Online ---"
echo "Supervisor ready in this pane."
